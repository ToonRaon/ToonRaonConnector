<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>철권 커맨드 입력기</title>
  <link rel="stylesheet" href="tekken-style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="../plug-in/jquery-3.3.1.js"></script>
</head>
<body id="body">
  <div class="header" id="stickyHeader">
    <button class="minimize" id="minimize_button">
      ▲
    </button>
    <div class="grid_class">
      <div class="cell_parent" id="white_cell">
        <p class="header_title">
          레버 기본
        </p>
        <div class="horizontal_grid">
          <div class="cell_child" id="white_cell_content">
            
          </div>
          <div class="cell_child" id="black_cell_content">

          </div>
        </div>
      </div>
      <div class="cell_parent" id="command_cell">
        <p class="header_title">
          버튼
        </p>
        <div class="cell_child" id="command_cell_content">
          <div class="command_cell_div" id="command_cell_div1">
            
          </div>
          <div class="command_cell_div" id="command_cell_div2">
            
          </div>
        </div>
      </div>
      <div class="cell_parent" id="misc_cell">
        <p class="header_title">
          기타
        </p>
        <div class="cell_child" id="misc_cell_content">
          
        </div>
      </div>
      <div class="cell_parent" id="bg_color_cell">
        <p class="header_title">
          배경색
        </p>
        <div class="cell_child" id="bg_color_cell_content">
          <button class="bgColor" id="bgcolor" style="background-color: #F0F3BD;" onclick="document.documentElement.style.setProperty('--bg-color', '#F0F3BD');"></button>
          <button class="bgColor" id="yellowgreen" style="background-color: yellowgreen;" onclick="document.documentElement.style.setProperty('--bg-color', 'yellowgreen');"></button>
          <button class="bgColor" id="white" style="background-color: white;" onclick="document.documentElement.style.setProperty('--bg-color', 'white');"></button>
          <button class="bgColor" id="LightSlateGray" style="background-color: LightSlateGray;" onclick="document.documentElement.style.setProperty('--bg-color', 'lightslategray');"></button>
          <button class="bgColor" id="darkblue" style="background-color: darkblue;" onclick="document.documentElement.style.setProperty('--bg-color', 'darkblue');"></button>
          <button class="bgColor" id="gray" style="background-color: gray;" onclick="document.documentElement.style.setProperty('--bg-color', 'gray');"></button>
          <button class="bgColor" id="forestgreen" style="background-color: forestgreen;" onclick="document.documentElement.style.setProperty('--bg-color', 'forestgreen');"></button>
        </div>
      </div>
      <div class="cell_parent" id="web_control_cell">
        <p class="header_title">
          출력 창
        </p>
        <div class="cell_child" id="web_control_cell_content">
          <button class="web_control_button" onclick="if(document.getElementById('commands').childNodes.length != 0) addTag(commands, 'br'); var btn = addTag(commands, 'input', 'inputTitle'); btn.focus(); btn.onclick = function() { btn.parentNode.removeChild(btn); }; addTag(commands, 'br');">글 삽입</button>
          <button class="web_control_button tooltip" title="엔터" onclick="addTag(commands, 'br'); var span = addTag(commands, 'span'); span.className = 'highlighter'; setTimeout( function(){ span.style.display = 'none'; }, 300); ">줄 바꿈<span class="tooltip-text">줄 바꿈<br>(단축키: 엔터)</span></button>
          <button class="web_control_button" onclick="commands.innerText = '';">전체지움</button>
          <button class="web_control_button tooltip" onclick="var childList = document.getElementById('commands').childNodes; var lastChild = childList[childList.length - 1]; lastChild.parentNode.removeChild(lastChild);">지우기<span class="tooltip-text">지움<br>(단축키: 백스페이스/딜리트)</span></button>
        </div>
      </div>
      <div class="hidden_header" id="hidden_header_id">
        <br>
      </div>
    </div>
  </div>
  
  <div id="result_cell">
    <p class="output_title" id="output_title_id">출력 창</p>
    <div id="commands">
      
    </div>
  </div>
  
  <script>
    var whiteCell = document.getElementById("white_cell_content");
    var blackCell = document.getElementById("black_cell_content");
    var commandCell = document.getElementById("command_cell_content");
    var miscCell = document.getElementById("misc_cell_content");
    var resultCell = document.getElementById("result_cell_content");
    var commands = document.getElementById("commands");
    var command1 = document.getElementById("command_cell_div1");
    var command2 = document.getElementById("command_cell_div2");
    var webContent = document.getElementById("web_control_cell_content");
    var minimizeButton = document.getElementById("minimize_button");
    
    // 모바일 모드 최소화 버튼
    minimizeButton.onclick = function() {
      var cellChildList = document.getElementsByClassName("cell_child");
      var cellParentList = document.getElementsByClassName("cell_parent");
      
      if(this.innerText == "▲") { // 펼쳐진 상태
        for(var i = 0; i < cellParentList.length; i++) {
          cellParentList[i].style.display = "none";
        }
        this.innerText = "▼";
        $(hidden_header_id).css("display", "block");
      } else { // 접혀진 상태
        for(var i = 0; i < cellParentList.length; i++) {
          cellParentList[i].style.display = "grid";
        }
        this.innerText = "▲";
        $(hidden_header_id).css("display", "none");
      }
    };
    
    // 방향키 순서가 7 8 9 / 4 5 6 / 1 2 3 이렇게 되어 있어서 for문 한 개로 하면 오히려 복잡해짐
    // 흰 방향키
    addImageButton(whiteCell, "./images/w7.png", "cmd tooltip", null, null, "레버 7\n(단축키: 키패드 7)");
    addImageButton(whiteCell, "./images/w8.png", "cmd tooltip", null, null, "레버 8\n(단축키: 키패드 8)");
    addImageButton(whiteCell, "./images/w9.png", "cmd tooltip", null, null, "레버 9\n(단축키: 키패드 9)");
    addImageButton(whiteCell, "./images/w4.png", "cmd tooltip", null, null, "레버 4\n(단축키: 키패드 4)");
    addImageButton(whiteCell, "./images/n.png", "cmd tooltip", null, null, "레버 5\n(단축키: 키패드 5)");
    addImageButton(whiteCell, "./images/w6.png", "cmd tooltip", null, null, "레버 6\n(단축키: 키패드 6)");
    addImageButton(whiteCell, "./images/w1.png", "cmd tooltip", null, null, "레버 1\n(단축키: 키패드 1)");
    addImageButton(whiteCell, "./images/w2.png", "cmd tooltip", null, null, "레버 2\n(단축키: 키패드 2)");
    addImageButton(whiteCell, "./images/w3.png", "cmd tooltip", null, null, "레버 3\n(단축키: 키패드 3)");
    
    // 검은 방향키
    addImageButton(blackCell, "./images/b7.png", "cmd tooltip", null, null, "레버 7 유지");
    addImageButton(blackCell, "./images/b8.png", "cmd tooltip", null, null, "레버 8 유지");
    addImageButton(blackCell, "./images/b9.png", "cmd tooltip", null, null, "레버 9 유지");
    addImageButton(blackCell, "./images/b4.png", "cmd tooltip", null, null, "레버 4 유지");
    addImageButton(blackCell, "./images/n.png", "cmd tooltip", null, null, "레버 5 유지");
    addImageButton(blackCell, "./images/b6.png", "cmd tooltip", null, null, "레버 6 유지");
    addImageButton(blackCell, "./images/b1.png", "cmd tooltip", null, null, "레버 1 유지");
    addImageButton(blackCell, "./images/b2.png", "cmd tooltip", null, null, "레버 2 유지");
    addImageButton(blackCell, "./images/b3.png", "cmd tooltip", null, null, "레버 3 유지");
    
    // 스틱 버튼
    addImageButton(command1, "./images/lp.png", "cmd tooltip", null, null, "왼손\n(단축키: q)");
    addImageButton(command1, "./images/rp.png", "cmd tooltip", null, null, "오른손\n(단축키: w)");
    addImageButton(command1, "./images/lk.png", "cmd tooltip", null, null, "왼발\n(단축키: a)");
    addImageButton(command1, "./images/rk.png", "cmd tooltip", null, null, "오른발\n(단축키: s)");
    addImageButton(command2, "./images/al.png", "cmd tooltip", null, null, "왼손+왼발");
    addImageButton(command2, "./images/ar.png", "cmd tooltip", null, null, "오른손+오른발");
    addImageButton(command2, "./images/ap.png", "cmd tooltip", null, null, "양손");
    addImageButton(command2, "./images/ak.png", "cmd tooltip", null, null, "양발");
    addImageButton(command2, "./images/lprk.png", "cmd tooltip", null, null, "왼손+오른발");
    addImageButton(command2, "./images/rplk.png", "cmd tooltip", null, null, "오른손+왼발");
    
    // 기타 버튼
    addImageButton(miscCell, null, "misc_button no_background tooltip", null, "▶", "다음\n(단축키: 스페이스바)").style.display = "inline-block";
    addImageButton(miscCell, null, "misc_button no_background tooltip", "justInput", "와 동시에 ", "동시 입력");
    addImageButton(miscCell, null, "misc_button no_background tooltip", null, "~", "계속 유지");
    addImageButton(miscCell, null, "misc_button no_background tooltip", null, "[", "빠르게 연속 입력");
    addImageButton(miscCell, null, "misc_button no_background tooltip", null, "]", "빠르게 연속 입력");
    var accrueButton = addImageButton(miscCell, null, "misc_button no_background tooltip", null, "(누적)", "버튼을 누른 채 떼지 않고 유지");
    var actualInput = addImageButton(miscCell, null, "misc_button no_background tooltip", null, "(실입력)", "누적을 적용하여 철권에서 인식하는 실제 입력");
//     addImageButton(miscCell, null, "misc_button no_background tooltip", null, "_", "잠시 유지");
    
    // 기타 버튼 2
    var miscList = ["스크류", "대시", "카운터", "벽꽝", "플로어 브레이크", "발코니 브레이크", "벽 브레이크", "레아", "레드", "일어나며", "앉은 상태에서", "앉으며", "흘리기", "횡캔"];
    for (var i in miscList) {
      var btn = addImageButton(miscCell, null, "misc_button tooltip", null, miscList[i], null);
      i == 0 || i == 1 ? btn.style.display = "inline-block" : null;
    }
    
    // 펼치기 버튼(기타 셀)
    addImageButton(miscCell, null, "expand tooltip", null, "+", "펼치기").onclick = function() {
      if(this.innerText == "+펼치기" || this.innerText == "+") { // 숨겨진 상태
        $('.misc_button').addClass("show");
        
        this.innerText = "-";
        var spanTag = document.createElement("span");
        spanTag.className = "tooltip-text";
        spanTag.innerText = "숨기기";
        
        this.appendChild(spanTag);
      } else { // 펼쳐진 상태
        $('.misc_button').removeClass("show");
        
        this.innerText = "+";
        var spanTag = document.createElement("span");
        spanTag.className = "tooltip-text";
        spanTag.innerText = "펼치기";
        
        this.appendChild(spanTag);
      }
    };
    
    
    // 누적 버튼 구현
    accrueButton.onclick = function() {
      var container = addTag(commands, "span", "accrue_container");
      var accrueText = addTag(container, "p", "accrue_text", null);
      var inputTarget = addTag(container, "span", "accrue_button_container", "inputTarget");
      
      accrueText.innerText = "누적";
      
      container.onclick = function() {
        this.parentNode.removeChild(this);
      }
    };
    
    // 실입력 버튼 구현
    actualInput.onclick = function() {
      var container = addTag(commands, "span", "actual_input_container");
      var actualInputTitleContainer = addTag(container, "div", "actual_input_title_container", "actualInputTitleContainer");
      var actualInputText1 = addTag(actualInputTitleContainer, "p", "actual_input_text", null);
      var actualInputText2 = addTag(actualInputTitleContainer, "span", "actual_input_text", null);
      var actualInputButtonContainer = addTag(actualInputTitleContainer, "span", "actual_input_button", "inputTarget");
      var actualInputText3 = addTag(actualInputTitleContainer, "span", "actual_input_text", null);
      var inputResultButtonContainer = addTag(container, "span", "input_result_button_container", "inputTarget");
      
      actualInputText1.style.fontSize = "10px";
      
      actualInputText1.innerText = "실입력";
      actualInputText2.innerText = "(";
      actualInputText3.innerText = ")";
      
      container.onclick = function() {
        this.parentNode.removeChild(this);
      }
    }
    
    
    function addImageButton(cell, url, className, id, text, tooltip) {
      var btn = document.createElement("button");
      if(className != null) btn.className = className;
      if(url != null) btn.style.backgroundImage = "url('" + url + "')";
      if(id != null) btn.id = id;
      if(text != null) btn.innerText = text;
      if(tooltip != null) {
        var spanTag = document.createElement("span");
        spanTag.className = "tooltip-text";
        spanTag.innerText = tooltip;
        
        btn.appendChild(spanTag);
      }
      cell.appendChild(btn);
      
      btn.onclick = function() { // 버튼 클릭하면 result 셀에 복사
        var target = document.getElementById("inputTarget") == null ? commands : document.getElementById("inputTarget"); // 누적 버튼 구현을 위함
        
        var copy = addImageButton(target, url, className, id, text, "클릭하여 삭제");
        copy.onclick = function() { copy.parentNode.removeChild(copy); }; // 복사된 버튼은 누르면 자기 자신을 삭제
        
        if(target != commands) {
          target.id = null;
        }
      };
      
      return btn;
    }
    
    function addTag(cell, tag, className, id) {
      var element = document.createElement(tag);
      if(className != null) element.setAttribute("class", className);
      if(id != null) element.setAttribute("id", id);
      cell.appendChild(element);
      
      return element;
    }
    
    
    
    // 키 입력 체크
    document.body.addEventListener('keydown', function (e) {
      if(document.activeElement.className == "inputTitle") return; // 글 삽입할 땐 단축키 동작 금지
      
      if(e.keyCode == 32 || e.keyCode == 13) e.preventDefault(); // 이거 안 해놓으니까 버튼 클릭 후 스페이스 바 or 엔터 키를 누르면 포커스가 남아있어서 이전 버튼이 눌려짐
//       alert(e.ke yCode);
      
      var url;
      switch(e.keyCode) {
        case 97: // 키패드 1
          url = "./images/w1.png";
          break;
        case 98: // 키패드 2
          url = "./images/w2.png";
          break;
        case 99: // 키패드 3
          url = "./images/w3.png";
          break;
        case 100: // 키패드 4
          url = "./images/w4.png";
          break;
        case 101: // 키패드 5
          url = "./images/n.png";
          break;
        case 102: // 키패드 6
          url = "./images/w6.png";
          break;
        case 103: // 키패드 7
          url = "./images/w7.png";
          break;
        case 104: // 키패드 8
          url = "./images/w8.png";
          break;
        case 105: // 키패드 9
          url = "./images/w9.png";
          break;
        case 81: // Q
          url = "./images/lp.png";
          break;
        case 87: // W
          url = "./images/rp.png";
          break;
        case 65: // A
          url = "./images/lk.png";
          break;
        case 83: // S
          url = "./images/rk.png";
          break;
        case 32: // 스페이스바
          addImageButton(commands, null, "misc_button no_background tooltip", null, "▶", "클릭하여 삭제").onclick = function() { this.parentNode.removeChild(this); };
          return false;
        case 13: // 엔터
          addTag(commands, "br");
          return;
        case 8:
        case 46:
          var childList = commands.childNodes;
          var lastChild = childList[childList.length - 1];
          lastChild.parentNode.removeChild(lastChild);
          return;
        default:
          return;
      }
      
      var target = document.getElementById("inputTarget") == null ? commands : document.getElementById("inputTarget"); // 누적 버튼 구현을 위함
        
      var copy = addImageButton(target, url, "cmd tooltip", null, null, "클릭하여 삭제");
      copy.onclick = function() { copy.parentNode.removeChild(copy); }; // 복사된 버튼은 누르면 자기 자신을 삭제

      if(target != commands) {
        target.id = null;
      }
    });
  </script>
</body>
</html>